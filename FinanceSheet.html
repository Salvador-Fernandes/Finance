<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Finance Sheet</title>
    <link rel="shortcut icon" type="image/x-icon" href="https://favicon.twenty.com/github.com/192" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
      html {
        font-size: 14px;
      }

      .text-bold {
        font-weight: bold !important;
      }

      .text-color {
        color: red !important;
      }

      .text-amount {
        text-align: right !important;
      }
    </style>
  </head>
  <body>
    <div class="container my-5">
      <h1>Finance Sheet</h1>
      <div class="container">
        <main class="col-12">
          <form method="get">
            <div class="row g-3">
              <div class="col-12 d-inline-flex">
                <label for="emitype" class="form-label" style="min-width: 150px !important">EMI Type</label>
                <select class="form-select" id="emitype" required>
                  <option value="0">Zero Cost</option>
                  <option value="1">Low Cost</option>
                </select>
              </div>
              <div class="col-12 d-inline-flex">
                <label for="pramount" class="form-label" style="min-width: 150px !important">Principal Amount</label>
                <input type="number" class="form-control" id="pramount" placeholder="" value="" required>
              </div>
              <div class="col-12 d-inline-flex">
                <label for="roi" class="form-label" style="min-width: 150px !important">Rate of Interest</label>
                <div class="input-group">
                  <input type="number" class="form-control" id="roi" placeholder="" value="15.99" required>
                  <span class="input-group-text">%</span>
                </div>
              </div>
              <div class="col-12 d-inline-flex">
                <label for="tenure" class="form-label" style="min-width: 150px !important">Tenure</label>
                <select class="form-select" id="tenure" required>
                  <option value="3">3 Months</option>
                  <option value="6">6 Months</option>
                  <option value="9">9 Months</option>
                  <option value="12">1 Year</option>
                  <option value="15">1 Year 3 Months</option>
                  <option value="18">1 Year 6 Months</option>
                  <option value="21">1 Year 9 Months</option>
                  <option value="24">2 Years</option>
                </select>
              </div>
              <div class="col-12 d-inline-flex">
                <label for="procfee" class="form-label" style="min-width: 150px !important">Processing Fee</label>
                <input type="number" class="form-control" id="procfee" placeholder="" value="199" required>
              </div>
              <div class="col-12 d-inline-flex">
                <label for="gst" class="form-label" style="min-width: 150px !important">GST</label>
                <div class="input-group">
                  <input type="number" class="form-control" id="gst" placeholder="" value="18.00" required>
                  <span class="input-group-text">%</span>
                </div>
              </div>
              <button class="w-100 btn btn-lg btn-dark" type="button" id="process">Process</button>
            </div>
          </form>
        </main>
        <hr />
        <main class="col-12 table-responsive">
          <table class="table">
            <tbody id="myTable"></tbody>
          </table>
        </main>
      </div>
    </div>
    <script>
      function roundoff(value) {
        return parseFloat(value).toFixed(2);
      }

      function createCell(type, text, styles) {
        var node = document.createElement(type);
        if (styles) {
          for (let style of styles.split(" ")) {
            node.classList.add(style);
          }
        }
        var text = document.createTextNode(text);
        node.appendChild(text);
        return node;
      }

      function createRowBlank(cols) {
        var node = document.createElement('td');
        node.colSpan = cols;
        return node;
      }

      function createTable(procfee, gst, pramount, roi, tenure, emitype) {
        var myTable = document.getElementById('myTable');
        myTable.innerHTML = '';

        //Processing Fee
        var tr = document.createElement('tr');
        tr.appendChild(createCell('th', 'Processing Fee'));
        tr.appendChild(createCell('td', roundoff(procfee), 'text-amount'));
        tr.appendChild(createCell('th', 'Tax'));
        tr.appendChild(createCell('td', roundoff(procfee * gst), 'text-amount'));
        tr.appendChild(createCell('td', roundoff(procfee + procfee * gst), 'text-amount text-color'));
        myTable.appendChild(tr);

        var tr = document.createElement('tr');
        tr.appendChild(createRowBlank(6))
        myTable.appendChild(tr);

        //Monthly Installment Calculations            
        var tr = document.createElement('tr');
        tr.appendChild(createCell('th', 'Principal'));
        tr.appendChild(createCell('th', 'Interest'));
        tr.appendChild(createCell('th', 'Tax'));
        tr.appendChild(createCell('th', 'Total w/o Tax'));
        tr.appendChild(createCell('th', 'Total'));
        myTable.appendChild(tr);
        var tempPramount = pramount;
        var tempInstall = pramount;
        var tempInterest = 0;
        var tempTotalInstall = 0;
        var tempTotalInterest = 0;
        for (let i = 1; i <= tenure; i++) {
          tempInterest = roi / (Math.pow(1 + roi, tenure) - 1) * (tempInstall * Math.pow(1 + roi, tenure) - tempInstall);
          tempInstall = (pramount / tenure) - tempInterest;
          tempTotalInstall += tempInstall;
          tempTotalInterest += tempInterest;
          var tr = document.createElement('tr');
          tr.appendChild(createCell('td', roundoff(tempInstall), 'text-amount'));
          tr.appendChild(createCell('td', roundoff(tempInterest), 'text-amount'));
          tr.appendChild(createCell('td', roundoff(tempInterest * gst), 'text-amount'));
          tr.appendChild(createCell('td', roundoff(tempInstall + tempInterest), 'text-amount'));
          tr.appendChild(createCell('td', roundoff(tempInstall + tempInterest * (1 + gst)), 'text-amount text-color'));
          myTable.appendChild(tr);
          tempInstall = tempPramount - (tempInstall + tempInterest);
          tempPramount = tempInstall;
        }
        var tr = document.createElement('tr');
        tr.appendChild(createCell('td', roundoff(tempTotalInstall), 'text-amount text-bold'));
        tr.appendChild(createCell('td', roundoff(tempTotalInterest), 'text-amount text-bold'));
        tr.appendChild(createCell('td', roundoff(tempTotalInterest * gst), 'text-amount text-bold'));
        tr.appendChild(createCell('td', roundoff(tempTotalInstall + tempTotalInterest), 'text-amount text-bold'));
        tr.appendChild(createCell('td', roundoff(tempTotalInstall + tempTotalInterest * (1 + gst)), 'text-amount text-bold'));
        myTable.appendChild(tr);
        return tempTotalInterest;
      }

      document.getElementById("process").addEventListener("click", function() {
        var procfee = parseFloat(document.getElementById("procfee").value);
        var gst = parseFloat(document.getElementById("gst").value) * 0.01;
        var pramount = parseFloat(document.getElementById("pramount").value);
        var roi = parseFloat(document.getElementById("roi").value) / 12 / 100;
        var tenure = parseFloat(document.getElementById("tenure").value);
        var emitype = parseFloat(document.getElementById("emitype").value);
        var interest = createTable(procfee, gst, pramount, roi, tenure, emitype);
        if (emitype != 0) {
          createTable(procfee, gst, pramount + interest, roi, tenure, emitype);
        }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>
